# Backup Service Container - Handles Docker Hub backups and data persistence
FROM alpine:latest

# Install necessary tools
RUN apk add --no-cache \
    docker \
    docker-compose \
    curl \
    bash \
    jq \
    python3 \
    py3-pip \
    && pip3 install --no-cache-dir requests docker-py

# Install Docker CLI (for Docker Hub operations)
RUN apk add --no-cache docker-cli

# Create app directory
WORKDIR /app

# Copy backup scripts
COPY scripts/backup-* /app/
COPY scripts/docker-hub-* /app/

# Make scripts executable
RUN chmod +x /app/backup-* /app/docker-hub-*

# Create backup directories
RUN mkdir -p /app/backups /app/logs

# Copy entrypoint script
COPY scripts/backup-service.sh /app/backup-service.sh
RUN chmod +x /app/backup-service.sh

# Health check
HEALTHCHECK --interval=300s --timeout=30s --start-period=60s --retries=3 \
  CMD echo "Backup service running"

# Default command
CMD ["/app/backup-service.sh"]